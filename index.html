<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Primary Meta Tags -->
    <title>PEMILOS - Situs Resmi Pemilihan Ketua dan Wakil Ketua OSIM MTSN 3 Tulungagung</title>
    <meta name="description" content="Pemilihan Ketua dan Wakil Ketua OSIM MTSN 3 Tulungagung. Ikuti perkembangan kandidat, timeline, dan informasi pemilihan secara real-time.">
    <meta name="keywords" content="pemilos, osim, mtsn 3 tulungagung, pemilihan osim, pemilos, organisasi siswa, madrasah tsanawiyah, tulungagung, pemilihan ketua osim">
    <meta name="author" content="Panitia Pemilihan OSIM MTSN 3 Tulungagung">
    <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://pemilos.ossnega.web.id/">
    <meta property="og:title" content="Pemilos 2025 - Pemilihan OSIM MTSN 3 Tulungagung">
    <meta property="og:description" content="Pemilihan Ketua dan Wakil Ketua OSIM. Bersatu Maju, Wujudkan Prestasi Gemilang! Ikuti perkembangan kandidat dan informasi pemilihan.">
    <meta property="og:image" content="https://pemilos.ossnega.web.id/assets/og-image.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:image:type" content="image/png">
    <meta property="og:image:alt" content="Pemilos 2025 - Pemilihan OSIM MTSN 3 Tulungagung - Banner Official">
    <meta property="og:site_name" content="Pemilos MTSN 3 Tulungagung">
    <meta property="og:locale" content="id_ID">
    <meta property="og:updated_time" content="2024-12-19T00:00:00+07:00">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://pemilos.ossnega.web.id/">
    <meta property="twitter:title" content="Pemilos 2025 - Pemilihan OSIM MTSN 3 Tulungagung">
    <meta property="twitter:description" content="Pemilihan Ketua dan Wakil Ketua OSIM periode 2025-2026. Bersatu Maju, Wujudkan Prestasi Gemilang!">
    <meta property="twitter:image" content="https://pemilos.ossnega.web.id/assets/og-image.png">
    <meta property="twitter:image:alt" content="Pemilos 2025 - Pemilihan OSIM MTSN 3 Tulungagung">
    <meta property="twitter:creator" content="@ossnega">
    <meta property="twitter:site" content="@ossnega">

    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#06326c">
    <meta name="msapplication-TileColor" content="#06326c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Pemilos 2025">
    <meta name="application-name" content="Pemilos 2025">

    <!-- Canonical & Alternate URLs -->
    <link rel="canonical" href="https://pemilos.ossnega.web.id/">
    <link rel="alternate" hreflang="id" href="https://pemilos.ossnega.web.id/">
    <link rel="alternate" hreflang="x-default" href="https://pemilos.ossnega.web.id/">

    <!-- Favicon & App Icons -->
    <link rel="icon" type="image/x-icon" href="assets/favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="assets/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="assets/apple-touch-icon.png">

    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">

    <!-- Preload Critical Resources -->
    <link rel="preload" href="https://iili.io/foKDUYb.png" as="image">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <!-- CDN Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bitter:ital,wght@0,100..900;1,100..900&family=Lato:ital,wght@0,100;0,300;0,400;0,700;0,900;1,100;1,300;1,400;1,700;1,900&display=swap" rel="stylesheet">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/global.css">
    <link rel="stylesheet" href="css/components.css">

    <style>
        /* CSS untuk alert banner yang hilang otomatis */
        .alert-banner {
            transition: all 0.5s ease-in-out;
            overflow: hidden;
            max-height: 100px;
        }
        
        .alert-banner.hidden {
            max-height: 0;
            opacity: 0;
            padding-top: 0;
            padding-bottom: 0;
            margin: 0;
            border: none;
        }
        
        /* WhatsApp widget styling */
        .whatsapp-widget {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            transition: transform 0.3s ease;
        }
        
        .whatsapp-widget:hover {
            transform: scale(1.1);
        }

        /* Sidebar styling */
        .sidebar {
            position: fixed;
            top: 0;
            left: -300px;
            width: 300px;
            height: 100vh;
            background: white;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            transition: left 0.3s ease;
            z-index: 1002;
        }
        
        .sidebar.open {
            left: 0;
        }
        
        .sidebar-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1001;
            display: none;
        }
        
        .sidebar-overlay.active {
            display: block;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 batik-bg">
    <!-- Alert Banner dengan auto-hide -->
    <div id="officialAlert" class="alert-banner bg-blue-800 text-white py-3">
        <div class="container mx-auto px-4 flex justify-between items-center">
            <span class="font-bold text-sm md:text-base">üèõÔ∏è WEBSITE RESMI PEMILOS 2025 - Semua informasi di website ini adalah informasi resmi dan valid</span>
            <button id="closeAlert" class="text-white hover:text-yellow-300 ml-4 flex-shrink-0">
                <i class='bx bx-x text-xl'></i>
            </button>
        </div>
    </div>

    <!-- Include Components -->
    <div id="sidebar-container"></div>
    <div id="navbar-container"></div>
    <div id="whatsapp-container"></div>

    <!-- Main Content -->
    <div class="min-h-screen">
        <!-- Include Sections -->
        <div id="hero-section"></div>
        <div id="announcement-section"></div>
        <div id="twibbon-section"></div>
        <div id="candidates-section"></div>
        <div id="flyer-section"></div>
        <div id="how-to-vote-section"></div>
        <div id="timeline-section"></div>
        <div id="about-section"></div>
        <div id="question-section"></div>
        <div id="footer-section"></div>
    </div>

    <!-- JavaScript Libraries -->
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>

    <!-- Custom JavaScript -->
    <script src="js/script.js"></script>
    <script src="js/countdown.js"></script>
    
    <!-- Load Components dengan perbaikan -->
    <script>
        // Load components secara berurutan
        const loadComponents = async () => {
            try {
                // Load sidebar dengan fallback
                try {
                    const sidebarResponse = await fetch('components/sidebar.html');
                    if (sidebarResponse.ok) {
                        const sidebarHTML = await sidebarResponse.text();
                        document.getElementById('sidebar-container').innerHTML = sidebarHTML;
                        initializeSidebar();
                    } else {
                        throw new Error('Sidebar not found');
                    }
                } catch (error) {
                    console.error('Error loading sidebar:', error);
                    document.getElementById('sidebar-container').innerHTML = `
                        <div class="sidebar-overlay" id="sidebarOverlay"></div>
                        <div class="sidebar bg-white" id="mainSidebar">
                            <div class="p-4 border-b">
                                <div class="flex justify-between items-center">
                                    <h2 class="text-xl font-bold text-blue-800">Menu</h2>
                                    <button class="sidebar-close text-2xl text-gray-600 hover:text-red-600">
                                        <i class='bx bx-x'></i>
                                    </button>
                                </div>
                            </div>
                            <nav class="p-4">
                                <a href="#hero" class="block py-3 px-4 text-gray-700 hover:bg-blue-50 rounded-lg mb-2 sidebar-close">
                                    <i class='bx bx-home mr-3'></i>Beranda
                                </a>
                                <a href="#candidates" class="block py-3 px-4 text-gray-700 hover:bg-blue-50 rounded-lg mb-2 sidebar-close">
                                    <i class='bx bx-user mr-3'></i>Kandidat
                                </a>
                                <a href="#timeline" class="block py-3 px-4 text-gray-700 hover:bg-blue-50 rounded-lg mb-2 sidebar-close">
                                    <i class='bx bx-calendar mr-3'></i>Timeline
                                </a>
                                <a href="#about" class="block py-3 px-4 text-gray-700 hover:bg-blue-50 rounded-lg mb-2 sidebar-close">
                                    <i class='bx bx-info-circle mr-3'></i>Tentang
                                </a>
                            </nav>
                        </div>
                    `;
                    initializeSidebar();
                }

                // Load navbar dengan fallback
                try {
                    const navbarResponse = await fetch('components/navbar.html');
                    if (navbarResponse.ok) {
                        document.getElementById('navbar-container').innerHTML = await navbarResponse.text();
                    } else {
                        throw new Error('Navbar not found');
                    }
                } catch (error) {
                    console.error('Error loading navbar:', error);
                    document.getElementById('navbar-container').innerHTML = `
                        <nav class="bg-white shadow-lg sticky top-0 z-50">
                            <div class="container mx-auto px-4">
                                <div class="flex justify-between items-center py-4">
                                    <div class="flex items-center">
                                        <img src="https://iili.io/foKDUYb.png" alt="Logo PEMILOS" class="h-10 w-10 mr-3">
                                        <span class="text-xl font-bold text-blue-800">PEMILOS 2025</span>
                                    </div>
                                    <button class="sidebar-toggle text-2xl text-gray-700 hover:text-blue-600">
                                        <i class='bx bx-menu'></i>
                                    </button>
                                </div>
                            </div>
                        </nav>
                    `;
                }

                // Load WhatsApp widget dengan timeout
                const whatsappPromise = new Promise((resolve) => {
                    const timer = setTimeout(() => {
                        resolve(false); // Timeout setelah 5 detik
                    }, 5000);

                    fetch('components/whatsapp-widget.html')
                        .then(response => {
                            clearTimeout(timer);
                            if (response.ok) return response.text();
                            throw new Error('WhatsApp widget not found');
                        })
                        .then(data => {
                            document.getElementById('whatsapp-container').innerHTML = data;
                            resolve(true);
                        })
                        .catch(error => {
                            console.error('Error loading WhatsApp widget:', error);
                            clearTimeout(timer);
                            resolve(false);
                        });
                });

                whatsappPromise.then(success => {
                    if (!success) {
                        document.getElementById('whatsapp-container').innerHTML = '';
                    }
                });

                // Load semua sections dengan error handling
                const sections = [
                    { id: 'hero-section', file: 'sections/hero.html' },
                    { id: 'announcement-section', file: 'sections/announcement.html' },
                    { id: 'twibbon-section', file: 'sections/twibbon.html' },
                    { id: 'candidates-section', file: 'sections/candidates.html' },
                    { id: 'flyer-section', file: 'sections/flyer.html' },
                    { id: 'how-to-vote-section', file: 'sections/how-to-vote.html' },
                    { id: 'timeline-section', file: 'sections/timeline.html' },
                    { id: 'about-section', file: 'sections/about.html' },
                    { id: 'question-section', file: 'sections/question.html' },
                    { id: 'footer-section', file: 'components/footer.html' }
                ];

                for (const section of sections) {
                    try {
                        const response = await fetch(section.file);
                        if (response.ok) {
                            const content = await response.text();
                            // Jika section twibbon kosong atau error, skip
                            if (section.id === 'twibbon-section' && content.trim().length < 50) {
                                document.getElementById(section.id).innerHTML = '';
                                continue;
                            }
                            document.getElementById(section.id).innerHTML = content;
                        } else {
                            // Skip section yang tidak ada
                            document.getElementById(section.id).innerHTML = '';
                        }
                    } catch (error) {
                        console.error(`Error loading ${section.file}:`, error);
                        // Kosongkan section yang error
                        document.getElementById(section.id).innerHTML = '';
                    }
                }

                // Initialize AOS setelah semua konten dimuat
                if (typeof AOS !== 'undefined') {
                    AOS.init({
                        duration: 800,
                        once: true,
                        offset: 100
                    });
                }

                // Setup event listeners setelah komponen dimuat
                setupEventListeners();

            } catch (error) {
                console.error('Error loading components:', error);
            }
        };

        // Initialize sidebar functionality
        function initializeSidebar() {
            const sidebar = document.getElementById('mainSidebar');
            const overlay = document.getElementById('sidebarOverlay');
            const toggleBtn = document.querySelector('.sidebar-toggle');
            const closeBtn = document.querySelector('.sidebar-close');

            if (toggleBtn) {
                toggleBtn.addEventListener('click', () => {
                    sidebar.classList.add('open');
                    overlay.classList.add('active');
                });
            }

            if (closeBtn) {
                closeBtn.addEventListener('click', () => {
                    sidebar.classList.remove('open');
                    overlay.classList.remove('active');
                });
            }

            if (overlay) {
                overlay.addEventListener('click', () => {
                    sidebar.classList.remove('open');
                    overlay.classList.remove('active');
                });
            }

            // Close sidebar when clicking on nav links
            document.querySelectorAll('.sidebar-close').forEach(link => {
                link.addEventListener('click', () => {
                    sidebar.classList.remove('open');
                    if (overlay) overlay.classList.remove('active');
                });
            });
        }

        // Setup event listeners untuk alert
        function setupEventListeners() {
            // Alert banner auto-hide dan manual close
            const alertBanner = document.getElementById('officialAlert');
            const closeAlertBtn = document.getElementById('closeAlert');
            
            if (alertBanner) {
                // Auto hide setelah 5 detik
                setTimeout(() => {
                    if (alertBanner) {
                        alertBanner.classList.add('hidden');
                    }
                }, 5000);
                
                // Manual close
                if (closeAlertBtn) {
                    closeAlertBtn.addEventListener('click', () => {
                        alertBanner.classList.add('hidden');
                    });
                }
            }
        }

        // Simple PWA initialization (tanpa service worker kompleks)
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js')
                .then(registration => console.log('SW registered'))
                .catch(error => console.log('SW registration failed'));
        }

        // Jalankan ketika DOM siap
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', loadComponents);
        } else {
            loadComponents();
        }
    </script>
</body>
</html>
